## Process this file with autoconf to produce Makefile

#if OS_WIN32
# no_undefined = -no-undefined
#endif

@SET_MAKE@
CC        = @CC@
CPP       = @CPP@
CFLAGS    = @CFLAGS@ @TICABLES_CFLAGS@ @TIFILES_CFLAGS@ @TICALCS_CFLAGS@ @GTHREAD_CFLAGS@ @GLIB_CFLAGS@ @GTK_CFLAGS@ @GLADE_CFLAGS@
LDFLAGS   = @LDFLAGS@ @TICABLES_LIBS@ @TIFILES_LIBS@ @TICALCS_LIBS@ @GTHREAD_LIBS@ @GLIB_LIBS@ @GTK_LIBS@ @GLADE_LIBS@ $(no_undefined)

INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@
prefix          = @prefix@
exec_prefix     = @exec_prefix@
bindir          = @bindir@
libdir          = @libdir@
ysconfdir      = @sysconfdir@

.SUFFIXES: .o .c .h .m .i .S .rc .res

DEFS=@DEFS@ \
	-DSHARE_DIR=\"${prefix}/share/tiemu\" \
	-DLOCALEDIR=\"${prefix}/share/locale\"
#	-DSHARE_DIR=\"$(pkgdatadir)\" \
#	-DLOCALEDIR=\"$(datadir)/locale\"

INCLUDES = \
	-I@top_srcdir@ -I$(includedir) \
	-DPREFIX=\"${prefix}\" -I. \
	-I./core -I./core/uae -I./core/ti_hw -I./core/ti_sw -I./core/dbg \
	-I./misc \
	-I./gui -I./gui/calc -I./gui/debugger

# source files to build
core_uae_OBJ = \
	core/uae/cpu0.o core/uae/cpu1.o \
	core/uae/cpu2.o core/uae/cpu3.o \
	core/uae/cpu4.o core/uae/cpu5.o \
	core/uae/cpu6.o core/uae/cpu7.o \
	core/uae/cpu8.o core/uae/cpu9.o \
	core/uae/cpuA.o core/uae/cpuB.o \
	core/uae/cpuC.o core/uae/cpuD.o \
	core/uae/cpuE.o core/uae/cpuF.o \
	core/uae/cpudefs.o core/uae/cpustbl.o \
	core/uae/readcpu.o

core_tihw_OBJ = \
	core/ti_hw/dbus.o	\
	core/ti_hw/flash.o	\
	core/ti_hw/gscales.o	\
	core/ti_hw/hw.o 	\
	core/ti_hw/kbd.o 	\
	core/ti_hw/m68k.o	\
	core/ti_hw/mem.o 	\
	core/ti_hw/mem89.o	\
	core/ti_hw/mem89tm.o	\
	core/ti_hw/mem92.o	\
	core/ti_hw/mem92p.o	\
	core/ti_hw/ports.o

core_tisw_OBJ = \
	core/ti_sw/handles.o	\
	core/ti_sw/registers.o	\
	core/ti_sw/romcalls.o	\
	core/ti_sw/timem.o

core_OBJ = 			\
	core/engine.o		\
	core/error.o 		\
	core/images.o 		\
	core/interface.o	\
	core/state.o		\
	core/type2str.o		\
	core/hwpm.o

core_dbg_OBJ = \
	core/dbg/bkpts.o	\
	core/dbg/debug.o	\
	core/dbg/disasm.o	\
	core/dbg/fpudasm.o	\
	core/dbg/m68kdasm.o

misc_OBJ = \
	misc/cmdline.o 	\
	misc/files.o 	\
	misc/paths.o 	\
	misc/printl.o	\
	misc/rcfile.o 	\
	misc/tie_error.o 

gui_calc_OBJ = \
	gui/calc/calc.o		\
	gui/calc/kbd_mapper.o	\
	gui/calc/keyboard.o	\
	gui/calc/keynames.o	\
	gui/calc/popup.o	\
	gui/calc/screen.o	\
	gui/calc/skinkeys.o	\
	gui/calc/skinops.o

gui_debugger_OBJ = \
	gui/debugger/dbg_all.o		\
	gui/debugger/dbg_bkpts.o	\
	gui/debugger/dbg_cause.o	\
	gui/debugger/dbg_code.o		\
	gui/debugger/dbg_data.o		\
	gui/debugger/dbg_heap.o		\
	gui/debugger/dbg_mem.o		\
	gui/debugger/dbg_pclog.o	\
	gui/debugger/dbg_regs.o		\
	gui/debugger/dbg_romcall.o	\
	gui/debugger/dbg_stack.o	\
	gui/debugger/dbg_vectors.o	\
	gui/debugger/gsource.o		

gui_OBJ = \
	gui/about.o							\
	gui/comm.o							\
	gui/dboxes.o							\
	gui/filesel.o							\
	gui/fs_misc.o							\
	gui/infos.o							\
	gui/main.o							\
	gui/manpage.o							\
	gui/pbars.o							\
	gui/refresh.o							\
	gui/release.o							\
	gui/romversion.o						\
	gui/scroptions.o						\
	gui/splash.o							\
	gui/support.o 							\
	gui/wizard.o

tiemu_OBJ = core/uae/newcpu.o \
	$(core_uae_OBJ) $(core_OBJ) $(core_tihw_OBJ) $(core_tisw_OBJ) \
	$(core_dbg_OBJ) \
	$(misc_OBJ) \
	$(gui_OBJ) $(gui_calc_OBJ) $(gui_debugger_OBJ)

#rules:
all: tiemu

uae:
#if OS_WIN32
	export CFLAGS="-mms-bitfields"
#endif
	cd core/uae && $(MAKE) gen
	cd core/uae && $(MAKE) all
#if OS_WIN32
	export CFLAGS=
#endif

tiemu: uae $(tiemu_OBJ)
#	$(CC) $(uae_OBJ) $(tiemu_OBJ) -o tiemu $(LDFLAGS) $(CFLAGS)
	../libtool --mode=link $(CC) $(uae_OBJ) $(tiemu_OBJ) \
	-o tiemu $(LDFLAGS) $(CFLAGS)

.c.o:
	$(CC) $(INCLUDES) $(DEFS) -c $(CFLAGS) $< -o $@
	#../libtool --mode=compile $(CC) $(INCLUDES) $(DEFS) \
	#-c $(CFLAGS) $< -o $@

clean:
	@cd core/uae && $(MAKE) clean
	@rm -f $(tiemu_OBJ) tiemu

distclean: clean
	@cd core/uae && $(MAKE) distclean

dos2unix:
	dos2unix
	lowercase
	uppercase

distdir: clean
	cp -rl * ../tiemu-@VERSION@/src

install: tiemu
	#@$(INSTALL) -m755 -d $(DESTDIR)$(tilp_help_dir)
	$(INSTALL) -m755 tiemu ${prefix}/bin